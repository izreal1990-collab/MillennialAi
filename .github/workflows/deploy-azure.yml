name: Deploy to Azure Container Apps

on:
  push:
    branches: [ main ]
  workflow_dispatch:

env:
  AZURE_WEBAPP_NAME: millennialai-app
  AZURE_RESOURCE_GROUP: millennialai-rg

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
    
    - name: Build Docker image
      run: |
        docker build -t ${{ env.AZURE_WEBAPP_NAME }}:${{ github.sha }} .
        docker tag ${{ env.AZURE_WEBAPP_NAME }}:${{ github.sha }} ${{ env.AZURE_WEBAPP_NAME }}:latest
    
    - name: Log deployment info
      run: |
        echo "âœ… Self-learning features deployed"
        echo "ðŸ“Š New endpoints available:"
        echo "  - /api/feedback"
        echo "  - /api/self-reflect"
        echo "  - /api/training-loop/*"
        echo "  - /api/learn-from-conversation"
        echo "  - /api/learning/summary"
